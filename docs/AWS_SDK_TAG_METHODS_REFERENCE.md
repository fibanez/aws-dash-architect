# AWS SDK Tag Fetching Method Reference

**Generated by analyzing actual Rust AWS SDK source code**

This document contains REAL function signatures from aws-sdk-* crates for fetching tags, extracted from the official AWS Rust SDK.

---

## Summary

**Total Services**: 80
**Total Resource Types**: 175

**Services with service-specific tag methods**: 13
**Services using Resource Groups Tagging API**: 67

---

## How to Use This Reference

Each service section documents:
- **SDK Crate**: The Rust crate name (`aws-sdk-{service}`)
- **Tag Method**: The specific method to call (e.g., `list_tags_for_resource`)
- **Parameter Type**: What identifier the method requires (ARN, resource-id, name, etc.)
- **Rust Function Signature**: Actual method signature from the SDK
- **Resources**: All resource types that use this service's tag method

---

## Services with Service-Specific Tag Methods

### CloudFormation

**SDK Crate**: `aws-sdk-cloudformation`
**Resource Types**: 1
**Tag Method**: Tags embedded in `describe_stacks()` response
**Parameter Type**: Stack name
**Implementation**: Tags are returned directly in the DescribeStacksOutput - no separate tag API call needed

**Rust Function Signature**:
```rust
// Tags are embedded in Stack object from describe_stacks()
client.describe_stacks()
    .stack_name(stack_name)
    .send()
    .await?;
// Response contains Stack.tags field
```

**Resources**:
- `AWS::CloudFormation::Stack`

**Implementation Notes**:
- CloudFormation stacks include tags in the `describe_stacks` response
- No separate tag API call is needed
- Tags are in the `Stack.tags` field of the response
- This is more efficient than other services as it requires no additional API call

---

### CloudFront

**SDK Crate**: `aws-sdk-cloudfront`
**Resource Types**: 1
**Tag Method**: `list_tags_for_resource`
**Parameter Type**: `resource_arn`

**Rust Function Signature**:
```rust
client.list_tags_for_resource()
    .resource(resource_arn)  // ARN format required
    .send()
    .await?;
```

**Resources**:
- `AWS::CloudFront::Distribution`

---

### DynamoDB

**SDK Crate**: `aws-sdk-dynamodb`
**Resource Types**: 1
**Tag Method**: `list_tags_of_resource`
**Parameter Type**: `resource_arn`

**Rust Function Signature**:
```rust
client.list_tags_of_resource()
    .resource_arn(resource_arn)  // ARN format required
    .send()
    .await?;
```

**Resources**:
- `AWS::DynamoDB::Table`

---

### EC2

**SDK Crate**: `aws-sdk-ec2`
**Resource Types**: 18
**Tag Method**: `describe_tags`
**Parameter Type**: `resource-id` (via filters)

**Rust Function Signature**:
```rust
use aws_sdk_ec2::types::Filter;

client.describe_tags()
    .filters(Filter::builder()
        .name("resource-id")
        .values(resource_id)  // EC2 resource ID (e.g., i-*, vol-*, vpc-*)
        .build())
    .send()
    .await?;
```

**Resources**:
- `AWS::EC2::FlowLog` (ID prefix: `fl-*`)
- `AWS::EC2::Image` (ID prefix: `ami-*`)
- `AWS::EC2::Instance` (ID prefix: `i-*`)
- `AWS::EC2::InternetGateway` (ID prefix: `igw-*`)
- `AWS::EC2::KeyPair` (name-based)
- `AWS::EC2::NatGateway` (ID prefix: `nat-*`)
- `AWS::EC2::NetworkAcl` (ID prefix: `acl-*`)
- `AWS::EC2::NetworkInterface` (ID prefix: `eni-*`)
- `AWS::EC2::RouteTable` (ID prefix: `rtb-*`)
- `AWS::EC2::SecurityGroup` (ID prefix: `sg-*`)
- `AWS::EC2::Snapshot` (ID prefix: `snap-*`)
- `AWS::EC2::Subnet` (ID prefix: `subnet-*`)
- `AWS::EC2::TransitGateway` (ID prefix: `tgw-*`)
- `AWS::EC2::VPC` (ID prefix: `vpc-*`)
- `AWS::EC2::VPCEndpoint` (ID prefix: `vpce-*`)
- `AWS::EC2::VPCPeeringConnection` (ID prefix: `pcx-*`)
- `AWS::EC2::Volume` (ID prefix: `vol-*`)
- `AWS::EC2::VolumeAttachment` (special case - inherit from volume)

**Implementation Notes**:
- ALL EC2 resources use the same method: `describe_tags()` with resource-id filter
- Resource IDs have specific prefixes (see list above)
- VolumeAttachment is special: it doesn't have tags of its own, tags are inherited from the volume
- This is the ONLY way to get tags for EC2 resources - Resource Groups Tagging API does NOT work for EC2

---

### ECS

**SDK Crate**: `aws-sdk-ecs`
**Resource Types**: 6
**Tag Method**: `list_tags_for_resource`
**Parameter Type**: `resource_arn`

**Rust Function Signature**:
```rust
client.list_tags_for_resource()
    .resource_arn(resource_arn)  // ARN format required
    .send()
    .await?;
```

**Resources**:
- `AWS::ECS::Cluster`
- `AWS::ECS::FargateService`
- `AWS::ECS::FargateTask`
- `AWS::ECS::Service`
- `AWS::ECS::Task`
- `AWS::ECS::TaskDefinition`

**Implementation Notes**:
- All ECS resources use ARN format
- Fargate services and tasks are ECS resources and use the same method

---

### EKS

**SDK Crate**: `aws-sdk-eks`
**Resource Types**: 2
**Tag Method**: `list_tags_for_resource`
**Parameter Type**: `resource_arn`

**Rust Function Signature**:
```rust
client.list_tags_for_resource()
    .resource_arn(resource_arn)  // ARN format required
    .send()
    .await?;
```

**Resources**:
- `AWS::EKS::Cluster`
- `AWS::EKS::FargateProfile`

---

### IAM

**SDK Crate**: `aws-sdk-iam`
**Resource Types**: 3
**Tag Methods**: `list_user_tags`, `list_role_tags`, `list_policy_tags`
**Parameter Type**: `resource-name` (except Policy which uses ARN)

**Rust Function Signatures**:
```rust
// Users
client.list_user_tags()
    .user_name(user_name)  // User name, NOT ARN
    .send()
    .await?;

// Roles
client.list_role_tags()
    .role_name(role_name)  // Role name, NOT ARN
    .send()
    .await?;

// Policies
client.list_policy_tags()
    .policy_arn(policy_arn)  // Policy ARN (exception!)
    .send()
    .await?;
```

**Resources**:
- `AWS::IAM::Policy` - Uses ARN
- `AWS::IAM::Role` - Uses name
- `AWS::IAM::User` - Uses name

**Implementation Notes**:
- IAM is unique: most resources use names, NOT ARNs
- Exception: Policies use ARN
- Each resource type has its own method
- Must extract name from resource identifier, not ARN

---

### KMS

**SDK Crate**: `aws-sdk-kms`
**Resource Types**: 1
**Tag Method**: `list_resource_tags`
**Parameter Type**: `key-id`

**Rust Function Signature**:
```rust
client.list_resource_tags()
    .key_id(key_id)  // Can be key ID, ARN, or alias
    .send()
    .await?;
```

**Resources**:
- `AWS::KMS::Key`

**Implementation Notes**:
- KMS accepts key ID, ARN, or alias
- Most flexible identifier acceptance

---

### Lambda

**SDK Crate**: `aws-sdk-lambda`
**Resource Types**: 3
**Tag Method**: `list_tags`
**Parameter Type**: `resource-arn`

**Rust Function Signature**:
```rust
client.list_tags()
    .resource(resource_arn)  // ARN format required
    .send()
    .await?;
```

**Resources**:
- `AWS::Lambda::EventSourceMapping`
- `AWS::Lambda::Function`
- `AWS::Lambda::LayerVersion`

**Implementation Notes**:
- Lambda does not support tagging function aliases or versions
- EventSourceMapping uses UUID format for resource ID
- LayerVersion uses layer version ARN

---

### RDS

**SDK Crate**: `aws-sdk-rds`
**Resource Types**: 5
**Tag Method**: `list_tags_for_resource`
**Parameter Type**: `resource_arn` (called "resource_name" in SDK but expects ARN)

**Rust Function Signature**:
```rust
client.list_tags_for_resource()
    .resource_name(resource_arn)  // Despite name, this expects ARN
    .send()
    .await?;
```

**Resources**:
- `AWS::RDS::DBCluster`
- `AWS::RDS::DBInstance`
- `AWS::RDS::DBParameterGroup`
- `AWS::RDS::DBSnapshot`
- `AWS::RDS::DBSubnetGroup`

**Implementation Notes**:
- Despite parameter being called "resource_name", it expects an ARN
- All RDS resources use the same method

---

### S3

**SDK Crate**: `aws-sdk-s3`
**Resource Types**: 1
**Tag Method**: `get_bucket_tagging`
**Parameter Type**: `bucket-name`

**Rust Function Signature**:
```rust
client.get_bucket_tagging()
    .bucket(bucket_name)  // Bucket name, NOT ARN
    .send()
    .await?;
```

**Resources**:
- `AWS::S3::Bucket`

**Implementation Notes**:
- S3 is unique: uses bucket name, NOT ARN
- Bucket name is a simple string (e.g., "my-bucket")
- Must extract bucket name from resource identifier or ARN

---

### SNS

**SDK Crate**: `aws-sdk-sns`
**Resource Types**: 1
**Tag Method**: `list_tags_for_resource`
**Parameter Type**: `resource_arn`

**Rust Function Signature**:
```rust
client.list_tags_for_resource()
    .resource_arn(resource_arn)  // ARN format required
    .send()
    .await?;
```

**Resources**:
- `AWS::SNS::Topic`

---

### SQS

**SDK Crate**: `aws-sdk-sqs`
**Resource Types**: 1
**Tag Method**: `list_queue_tags`
**Parameter Type**: `queue-url`

**Rust Function Signature**:
```rust
client.list_queue_tags()
    .queue_url(queue_url)  // Queue URL, NOT ARN
    .send()
    .await?;
```

**Resources**:
- `AWS::SQS::Queue`

**Implementation Notes**:
- SQS is unique: uses Queue URL, NOT ARN
- Queue URL format: `https://sqs.{region}.amazonaws.com/{account}/{queue-name}`
- Must construct URL from ARN or resource identifier

---

## Services Using Resource Groups Tagging API

The following **67 services** use the generic Resource Groups Tagging API. They all use ARN-based identification.

**SDK Crate**: `aws-sdk-resourcegroupstaggingapi`
**Tag Method**: `get_resources`
**Parameter Type**: `resource_arn`

**Rust Function Signature**:
```rust
use aws_sdk_resourcegroupstaggingapi::Client as TaggingClient;

tagging_client.get_resources()
    .resource_arn_list(resource_arn)
    .send()
    .await?;
```

**Services** (alphabetically):
- ACM
- ACMPCA
- AccessAnalyzer
- Amplify
- ApiGateway
- ApiGatewayV2
- AppRunner
- AppSync
- Athena
- AutoScaling
- Backup
- Batch
- Bedrock
- BedrockAgentCore
- CodeBuild
- CodeCommit
- CodePipeline
- Cognito
- Config
- Connect
- DataBrew
- DataSync
- Detective
- DocumentDB
- ECR
- EFS
- EMR
- ElastiCache
- ELB
- ELBv2
- EventBridge
- Fargate (uses ECS)
- FSx
- GlobalAccelerator
- Glue
- Greengrass
- GuardDuty
- Inspector
- IoT
- Kinesis
- KinesisFirehose
- LakeFormation
- Lex
- Logs (CloudWatch Logs)
- Macie
- MQ
- MSK
- Neptune
- OpenSearch
- Organizations
- Polly
- QuickSight
- Redshift
- Rekognition
- Route53
- SageMaker
- SecretsManager
- SecurityHub
- Shield
- SSM
- StepFunctions
- Timestream
- Transfer
- WAFv2
- WorkSpaces
- XRay

---

## Implementation Priority

### ðŸš¨ HIGH PRIORITY - Service-Specific Implementation Required

These resources REQUIRE service-specific implementation. Resource Groups Tagging API will NOT work:

1. **AWS::EC2::*** (18 resources) - MUST use `describe_tags()` with resource-id filter
2. **AWS::S3::Bucket** - MUST use `get_bucket_tagging()` with bucket name
3. **AWS::SQS::Queue** - MUST use `list_queue_tags()` with queue URL
4. **AWS::IAM::User** - MUST use `list_user_tags()` with user name
5. **AWS::IAM::Role** - MUST use `list_role_tags()` with role name
6. **AWS::IAM::Policy** - MUST use `list_policy_tags()` with policy ARN

### âš ï¸ MEDIUM PRIORITY - Service-Specific Preferred

These have service-specific methods that are more efficient than Resource Groups Tagging API:

- **CloudFormation** - Tags embedded in `describe_stacks()` (more efficient)
- **CloudFront**, **DynamoDB**, **ECS**, **EKS**, **KMS**, **Lambda**, **RDS**, **SNS** - Have dedicated methods

### âœ… LOW PRIORITY - Default Implementation Works

All other 67 services work with Resource Groups Tagging API using ARNs.

---

## Quick Reference Table

| Service | Method | Parameter Type | Example |
|---------|--------|----------------|---------|
| CloudFormation | `describe_stacks()` | Stack name | `my-stack` |
| CloudFront | `list_tags_for_resource()` | ARN | `arn:aws:cloudfront::123456789012:distribution/E1234567890ABC` |
| DynamoDB | `list_tags_of_resource()` | ARN | `arn:aws:dynamodb:us-east-1:123456789012:table/my-table` |
| EC2 | `describe_tags()` | Resource ID | `i-1234567890abcdef0` |
| ECS | `list_tags_for_resource()` | ARN | `arn:aws:ecs:us-east-1:123456789012:cluster/my-cluster` |
| EKS | `list_tags_for_resource()` | ARN | `arn:aws:eks:us-east-1:123456789012:cluster/my-cluster` |
| IAM (User) | `list_user_tags()` | User name | `john-doe` |
| IAM (Role) | `list_role_tags()` | Role name | `MyRole` |
| IAM (Policy) | `list_policy_tags()` | ARN | `arn:aws:iam::123456789012:policy/MyPolicy` |
| KMS | `list_resource_tags()` | Key ID/ARN | `1234abcd-12ab-34cd-56ef-1234567890ab` |
| Lambda | `list_tags()` | ARN | `arn:aws:lambda:us-east-1:123456789012:function:my-function` |
| RDS | `list_tags_for_resource()` | ARN | `arn:aws:rds:us-east-1:123456789012:db:mydb` |
| S3 | `get_bucket_tagging()` | Bucket name | `my-bucket` |
| SNS | `list_tags_for_resource()` | ARN | `arn:aws:sns:us-east-1:123456789012:my-topic` |
| SQS | `list_queue_tags()` | Queue URL | `https://sqs.us-east-1.amazonaws.com/123456789012/my-queue` |
| Others (67) | `get_resources()` (Tagging API) | ARN | `arn:aws:{service}:{region}:{account}:{resource}` |

---

## Implementation Code Examples

### EC2 Resources
```rust
use aws_sdk_ec2::Client as Ec2Client;
use aws_sdk_ec2::types::Filter;

async fn get_ec2_tags(client: &Ec2Client, resource_id: &str) -> Result<Vec<Tag>> {
    let result = client
        .describe_tags()
        .filters(Filter::builder()
            .name("resource-id")
            .values(resource_id)
            .build())
        .send()
        .await?;

    // Convert EC2 tags to our Tag format
    Ok(result.tags().iter().map(|tag| Tag {
        key: tag.key().unwrap_or("").to_string(),
        value: tag.value().unwrap_or("").to_string(),
    }).collect())
}
```

### S3 Buckets
```rust
use aws_sdk_s3::Client as S3Client;

async fn get_s3_bucket_tags(client: &S3Client, bucket_name: &str) -> Result<Vec<Tag>> {
    let result = client
        .get_bucket_tagging()
        .bucket(bucket_name)
        .send()
        .await?;

    Ok(result.tag_set().iter().map(|tag| Tag {
        key: tag.key().to_string(),
        value: tag.value().to_string(),
    }).collect())
}
```

### SQS Queues
```rust
use aws_sdk_sqs::Client as SqsClient;

async fn get_sqs_queue_tags(client: &SqsClient, queue_url: &str) -> Result<Vec<Tag>> {
    let result = client
        .list_queue_tags()
        .queue_url(queue_url)
        .send()
        .await?;

    Ok(result.tags().iter().map(|(k, v)| Tag {
        key: k.clone(),
        value: v.clone(),
    }).collect())
}
```

### IAM Users
```rust
use aws_sdk_iam::Client as IamClient;

async fn get_iam_user_tags(client: &IamClient, user_name: &str) -> Result<Vec<Tag>> {
    let result = client
        .list_user_tags()
        .user_name(user_name)
        .send()
        .await?;

    Ok(result.tags().iter().map(|tag| Tag {
        key: tag.key().to_string(),
        value: tag.value().to_string(),
    }).collect())
}
```

### Resource Groups Tagging API (Default)
```rust
use aws_sdk_resourcegroupstaggingapi::Client as TaggingClient;

async fn get_generic_tags(client: &TaggingClient, resource_arn: &str) -> Result<Vec<Tag>> {
    let result = client
        .get_resources()
        .resource_arn_list(resource_arn)
        .send()
        .await?;

    if let Some(resource) = result.resource_tag_mapping_list().first() {
        Ok(resource.tags().iter().map(|tag| Tag {
            key: tag.key().unwrap_or("").to_string(),
            value: tag.value().unwrap_or("").to_string(),
        }).collect())
    } else {
        Ok(Vec::new())
    }
}
```

---

**Generated**: 2025-01-17
**Source**: AWS Rust SDK crates in `~/.cargo/registry/src/`
